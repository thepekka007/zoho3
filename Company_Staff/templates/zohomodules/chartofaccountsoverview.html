{% extends 'base.html' %}
{% block content %}
{% load static %}
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>
<script src="https://raw.githack.com/eKoopmans/html2pdf/master/dist/html2pdf.bundle.js"></script>

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css">
<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha384-ez8n5b/9F3JpKCEY6zIp+Hg7IbU8d7Q5ST78iEiRaP2mNPjkDps8I+1i0fblDOoh" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.3/xlsx.full.min.js"></script>
<style>
     .modal {
    z-index: 9999;
    overflow: scroll;
  }

  .modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    width: 80%;
  }

</style>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"> -->
<!-- <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script> -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script> -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-xxxxxx" crossorigin="anonymous" />

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-xxxxxx" crossorigin="anonymous" />

<div class="body-wrapper" style="margin-left: 0; width: 100%;">

    <div class="container-fluid" style="width: 100%; margin: 0 auto;">

        <div class="col-md-12" style="width: 120%;">
            <div class="row">
              <div class="col-md-3" style="border-right: 1px solid white; overflow-y: scroll; height: 84vh;">
                <div class="row">
                  <a class="text-white" style="font-size: 1.5rem;">All Accounts</a>
               
                  <br>      
                  <div class="col-md-2">
                    <div class="dropdown">
                        <a class="btn text-center mt-2 btn-outline-warning" id="sortbutton" data-bs-toggle="dropdown" role="button" style="margin-left: 0; height: 38px;">
                            <i class="fas fa-sort m-1"></i>
                         </a>
                         
                         <div class="dropdown-menu m-1" style="background-color: black; color: white;">
                            <a class="dropdown-item dropdown-item-all" href="javascript:void(0);" style="background-color: black; color: white;">All</a>
                            <a class="dropdown-item dropdown-item-sort" href="javascript:void(0);" data-column-index="0" style="background-color: black; color: white;">Account Name</a>
               
                          </div>
                      
                    </div>
                  </div>
                  <div class="col-md-3" style="padding-left: 40px;">
                    <div class="col-md-2">
                      <div class="col-md-2  mt-2 mx-1">
                        <a class="btn text-center btn-outline-warning text-warning px-3 fa fa-filter" data-bs-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"></a>

                        <div class="dropdown-menu m-1" style="background-color: black; color: white;">
                            <a class="dropdown-item dropdown-item-filter-account-type" href="javascript:void(0);" style="background-color: black; color: white;">All</a>
                            <a class="dropdown-item dropdown-item-filter-account-type" href="javascript:void(0);" style="background-color: black; color: white;">Assets</a>
                            <a class="dropdown-item dropdown-item-filter-account-type" href="javascript:void(0);" style="background-color: black; color: white;">Liability</a>
                            <a class="dropdown-item dropdown-item-filter-account-type" href="javascript:void(0);" style="background-color: black; color: white;">Equity</a>
                            <a class="dropdown-item dropdown-item-filter-account-type" href="javascript:void(0);" style="background-color: black; color: white;">Income</a>
                            <a class="dropdown-item dropdown-item-filter-account-type" href="javascript:void(0);" style="background-color: black; color: white;">Expense</a>
                          </div>
                        
                      </div>
                    </div>
                        <br>
                  
           
                </div>
                  <div class="col-md-3 " style="padding-left: 40px;">
                    <a class="btn btn btn-outline-warning text-right mt-2" style="height: 38px; padding-top: 12px; padding-left: 17px;" href="{% url 'addchartofaccounts'%}"><i class="fa fa-plus"></i></a>

                  </div>
                  <div class="col-md-6"></div>
    
                </div>
    
                <div class="scrollable-table" style="width: 100%;">
                  <div class="row">
                    <div class="col-md-12">
                        <input type="text" id="search" placeholder="Search..." class="form-control text-dark bg-light" autocomplete="off">

                    </div>
                </div>
    
           
              
              
              <!-- Table 2: Billable Projects -->
              <table id="table2" class="table customer-table" style="border: 1px solid black; width: 100%; margin-left: 0;">

                <tbody>
                  {%for i in acc %}
                  <tr class="account-row" data-account-type="{{ i.account_type }}">
                    <td>
                      <a class="text-white"  href="{% url 'chartofaccountsoverview'  i.id%}"><b>{{i.account_name}}</b> <span class="d-flex justify-content-end text-warning align-items-start" > {{i.account_type}}</span> <br>
                          <span class="d-flex  align-items-start text-warning"> {{i.account_code}}</span> <span class="d-flex justify-content-end align-items-start"> {{i.Create_status}}</span>
                      </a> 
                  </td>
                  </tr>
                  {%endfor%}
                </tbody>
              </table>

    </div>
</div>


<div class="col" style="width: 300%;" id="overviewdiv" >
    <div class="row">
      <div class="col-md-7">
        <a class="text-white" style="font-size: 1.5rem;">
          <h2 style="color: aliceblue;">{{selacc.account_name}}</h2>
        </a>
      </div>
    </div>
    <div class="row">
      <div class="col-md-6">
        <a class="btn" style="background-color: chocolate; margin-right: 2vh;color: aliceblue;"><i class="fas fa-eye"></i>
          Overview</a>
       
        <!-- <a href=" " class=" btn fa fa-file-alt" data-bs-toggle="dropdown" id="attachmentDropdown"
          aria-haspopup="true" aria-expanded="false"
          style="background-color: white; color: black; margin-right: 2vh;"> Templates
        </a>

        <div class="dropdown-menu" aria-labelledby="attachmentDropdown">
          <a class="dropdown-item" onclick="totemplate()"><i class="fa fa-file-alt"></i> Template 1</a>

          <a class="dropdown-item" onclick="totemplate2()"><i class="fa fa-file-alt"></i>
            Template 2</a>

          <a class="dropdown-item" onclick="totemplate3()"><i class="fa fa-file-alt"></i>
            Template 3</a>


        </div> -->

      </div>

      <div class="col-md-6" style="text-align: center;">

       
        <a href="{% url 'editchartofaccounts'  selacc.id%}" class="btn btn-outline-warning py-2  text-warning 
        " title="save this draft" ><i class="fas fa-pencil-alt"></i>
    </a>
    <a href="{% url 'acc_status_edit' selacc.id %}" class="btn btn-outline-warning py-2" title="save this draft" style="height: 38px; margin-right: 3px;">{{selacc.status}}</a>
      
    <a href="{% url 'deleteaccount'  selacc.id%}" class="delete fa fa-trash btn btn-outline-warning text-warning px-2 py-2" data-toggle="tooltip" title="DELETE" onclick="return confirm('Do you want to Delete this creditnote?');" style="height: 38px; margin-right: 3px;"></a>
      
   
  
     
  
        <a class="text-dark" data-toggle="dropdown">
          <button class="btn btn-outline-warning " title="Share"><i class="fas fa-share"></i></button>
        </a>
        <div class="dropdown-menu ">
          <a class="dropdown-item" data-target="#shareBillEmail" data-toggle="modal">GMAIL</a>
          <a class="dropdown-item" href="javascript:void(0);" onclick="shareOnWhatsApp()">WhatsApp</a>
        </div>
       
        <a class="btn text-center mt-2 btn-outline-warning" id="sortbutton" data-bs-toggle="dropdown" role="button" style="margin-left: 0; height: 38px; margin-right: 3px;">
          <i class="fas fa-file-pdf"></i>
      </a>
      <div class="dropdown-menu m-1" style="background-color: rgb(74, 71, 71); color: white;">
        
      
        <a class="text-dark" onclick="exportToPDF3()">
          <button class="btn btn-outline-warning" title="Pdf" style="width: 100px;"><i class="fas fa-file-pdf"></i>PDf</button>
        </a>
<br>
        <a class=" text-dark" onclick="printSelectedArea2()">
          <button class="btn btn-outline-warning" title="Print" style="width: 100px;"><i class="fas fa-print"></i>PRINT
          </button>
        </a>  <br>
        <a class="btn btn-outline-warning py-2" style="cursor: pointer;" 
        onclick="exportToExcel()" style="width: 100px;">XLS (Excel)</a>
        </div>

          
               
                    <a href=" " class="btn  btn-outline-warning py-2  fas fa-comment-dots dropdown-toggle text-warning "  
                        data-bs-toggle="dropdown" id="attachmentDropdown" aria-haspopup="true" aria-expanded="false"> 
                    </a>

                    <div class="dropdown-menu" aria-labelledby="attachmentDropdown">
                        <a class="dropdown-item" style="cursor: pointer;" data-toggle="modal"
                         data-target="#cmnts"><i class="fa-solid fa fa-plus"></i>Add</a>
                        <a class="dropdown-item" style="cursor: pointer;" data-toggle="modal"
                        data-target="#cmt_list"><i class="fas fa-list"></i>&nbsp;View List</a>
                                
                    </div>
          
   

   
       
            
            <a class="btn btn-outline-warning py-2" style="cursor: pointer;" data-toggle="modal" data-target="#history" style="height: 38px; margin-right: 3px;">History</a>
      
    </div>
    </div><br>

    <div class="row" id="div-to-print"
      style="background-color: #ffddb0;  height: auto; margin-left:1px; margin-right: 1rem; ">

      <div class="row text-center">
        <h2 style="color: #000000;"><br>{{selacc.account_name}}
          <hr>
        </h2>
      </div>    

    
        <div class="row mt-3">
          <div class="col-5"><label class="text-black" for="">Account Type:</label></div>
          <div class="col-7">
            <p class="bold text-dark" style="max-width: 15rem;word-wrap: break-word;">{{selacc.account_type}}</p>
          </div>
        </div>
        <div class="row mt-3">
          <div class="col-5"><label class="text-black" for="">Account Code:</label></div>
          <div class="col-7">
            <p class="bold text-dark" style="max-width: 15rem;word-wrap: break-word;">
                {{selacc.account_code}}
              </p>
          </div>
        </div>
        <div class="row mt-3">
          <div class="col-5"><label class="text-black" for="">Description :</label></div>
          <div class="col-7">
            <p class="bold text-dark" style="max-width: 15rem;word-wrap: break-word;">
                {{selacc.description}}</p>
          </div>
        </div>
        <style>
            .dashed-line {
              border-top: 1px dashed #000; /* Set color and style */
              margin: 20px 0; /* Adjust margin for spacing */
            }
          </style>
          
          <div class="dashed-line"></div>

          <H3>Recent Transactions</H3>
          <br>
          <div></div>
          <div class="row mt-3">
            <div class="col-5"><label class="text-dark" for=""></label></div>
            <div class="col-7">
              <p class="bold text-dark" style="max-width: 15rem;word-wrap: break-word;"></p>
            </div>
          </div>
        <table class=" table table-hover table-bordered " id="table1" style="border-color: #000000;color: rgb(0, 0, 0);">
            <thead>
                <tr>

                  <th id="th" style="text-align: center;">Date</th>
                  <th id="th" style="text-align: center;">Type</th>
                
                  <th id="th" style="text-align: center;">Debit</th>
                  <th id="th" style="text-align: center;">Credit</th>
    
                
                </tr>
              </thead>
              <tbody>
             
                <tr style="color: black;">
                  <td style="text-align: center;"></td>
                  <td style="text-align: center;"> </td>
                
                  <td style="text-align: center;">  
                  </td>
                  <td style="text-align: center;"></td>
                </tr>
              </tbody>
        </table><br><br>
      
        <div class="row mt-3">
          <div class="col-5"><label class="text-dark" for=""></label></div>
          <div class="col-7">
            <p class="bold text-dark" style="max-width: 15rem;word-wrap: break-word;"></p>
          </div>
        </div>
        <div class="row mt-3">
          <div class="col-5"><label class="text-dark" for=""></label></div>
          <div class="col-7">
            <p class="bold text-dark" style="max-width: 15rem;word-wrap: break-word;"><br>
      
               </p>
          </div>
        </div>
      
        <div class="row mt-3">
          <div class="col-5"><label class="text-dark" for=""></label></div>
          <div class="col-7">
            <p class="bold text-dark" style="max-width: 15rem;word-wrap: break-word;"></p>
          </div>
        </div>
      </div>
    
    </div>

    

  </div>


<!-- SORT  AND FILTER SCRIPT -->
<script>
    $(document).ready(function() {
        // Event listener for dropdown menu links
        $('.dropdown-item-filter-account-type').click(function() {
            // Get the selected account type
            var selectedType = $(this).text().toLowerCase();
    
            // Show/hide table rows based on the selected account type
            $('.account-row').each(function() {
                var accountType = $(this).data('account-type').toLowerCase();
                if (selectedType === 'all' || accountType === selectedType) {
                    $(this).show();
                } else {
                    $(this).hide();
                }
            });
        });
    });

    $(document).ready(function() {
    // Initialize DataTable
    var table = $('#table2').DataTable({
        "paging": false, // Disable pagination if not needed
        "order": [[0, "asc"]], // Initial sorting by the first column (change as needed)
    });

    // Event listener for dropdown menu links
    $('.dropdown-item-filter-account-type').click(function() {
        // ... (your existing filtering logic)

        // Refresh DataTable after filtering
        table.draw();
    });

    // Event listener for sorting dropdown menu link
    $('.dropdown-item-sort').click(function() {
        var columnIndex = $(this).data('column-index');

        // Toggle between ascending and descending order
        var order = table.order()[0];
        if (order[0] === columnIndex) {
            order[1] = order[1] === 'asc' ? 'desc' : 'asc';
        } else {
            order = [columnIndex, 'asc'];
        }

        // Apply sorting
        table.order(order).draw();
    });
});
    </script>
    
  
<!-- print and pdf  and xcel scripts -->


<script>
  function printSelectedArea2(area) {
    // Get the HTML content of the table
    var printContents = document.getElementById("table1").innerHTML;
  
    // Open a new window
    var printWindow = window.open('', '_blank');
  
    // Add styles to hide specific elements during printing
    printWindow.document.write('<style>@media print { #searchInput, #filterWindow { display: none; } }</style>');
  
    // Add additional styles for the table layout
    printWindow.document.write('<style>table { border-collapse: collapse; width: 100%; }</style>');
    printWindow.document.write('<style>table, th, td { border: 1px solid black; }</style>');
  
    // Write the HTML content to the new window
    printWindow.document.write('<html><head><title>Print Data</title></head><body>');
    printWindow.document.write(document.getElementById('div-to-print').innerHTML);
    printWindow.document.write('</body></html>');
  
    // Print the new window
    printWindow.print();
  }
  
  
    function exportToPDF3() {
    var content = document.getElementById('div-to-print');
    

  
  // Hide the search input temporarily

    content.style.backgroundColor = 'white';
    content.style.color = 'black';
  
  

    // Apply styles to h1 elements within the content
    var h1Elements = content.getElementsByTagName('h1');
    for (var i = 0; i < h1Elements.length; i++) {
      h1Elements[i].style.color = 'black';
    }
  
    // Generate PDF using html2pdf
    html2pdf()
      .from(content)
      .save('{{selacc.account_name}}' + '.pdf');
  }
  function exportToExcel() {
      var table = document.querySelector('#table1'); // Add # to select by ID
      var ws = XLSX.utils.table_to_sheet(table);
      var wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');
      XLSX.writeFile(wb, 'account.xlsx');
  }
  
  </script>



<!-- history modal -->


<div class="modal fade" id="history">
  <div class="modal-dialog modal-xl">
    <div class="modal-content" style="background: rgb(32, 35, 37);border-radius: 20px;">
      <div class="modal-header" style="background: rgb(32, 35, 37);">
        <h5 class="m-3 text-uppercase" id="shareBillEmailLabel" style="color: #eeeaea;">Transaction History</h5>
        <button type="button" class="close" style="width: 30px;" data-dismiss="modal" aria-label="Close"><span
            aria-hidden="true">&times;</span></button>
      </div>
      <div class="modal-body" style="background: rgb(32, 35, 37);">
        <div class="card p-3 m-3" style="background-color: #000;">
        
          <table style="background-color: #000; margin-right: 10px; border-radius: 5px;">
            <thead class="text-white">
        
              <tr>
                <th style="color: rgb(250, 247, 242);">Action</th>
                <th style="color: rgb(244, 244, 244);">Date</th>
                  <th style="color: rgb(250, 247, 242);">Name</th>
             
                  
              </tr>
          </thead>
        <tbody style="background-color: black;">
          
          {% for i in latest_item_id %}
        <tr style="background-color: black;" class='clickable-row' data-href=""> 
          <td class="bg-dark text-white" style="color: rgb(0, 0, 0); background-color: black;">{{ i.action }}</td>            
          <td class="bg-dark text-white" style="color: rgb(0, 0, 0); background-color: black;">{{ i.Date }}</td>
          <td class="bg-dark text-white" style="color: rgb(0, 0, 0); background-color: black;">{{ i.logindetails.first_name }}&nbsp;{{ i.logindetails.last_name }}</td>
       </tr>
    {% endfor %}
    
      
        </tbody>
          </table>


    </div>
  </div>
</div>
{% endblock %}
